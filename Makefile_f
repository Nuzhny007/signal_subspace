# Michael Hirsch 2014

FC = gfortran
#---- What the EXE filename should be ---------------------------------
EXEC = test_esprit
#----Sources (in order of dependency) ---------------------------------
FSOURCES = comm.f90 perf.f90 subspace.f90 signals.f90 RunSubspace.f90
CSOURCES =
#----- libs you need --------------------------------------------------
LIBS = -lblas -llapack -lpthread
#----- suffix patterns ------------------------------------------------
#%.o: %.c
#	$(CC) $(CFLAGS) -c  -o $@ $<
%.o: %.F90
	$(FC) $(FFLAGS) -c  -o $@ $<
%.o: %.f90
	$(FC) $(FFLAGS) -c  -o $@ $<
%.o: %.F
	$(FC) $(FFLAGS) -c  -o $@ $<
%.o: %.f
	$(FC) $(FFLAGS) -c  -o $@ $<
#------------- FORTRAN ------------------------------------------------
FFLAGS = -Wall -pedantic -mtune=native -ffast-math -O3
FFLAGS += -g $(DBGFLAGS)

DBGFLAGS = -O0  -fbacktrace
DBGFLAGS += -fbounds-check

FOBJS = $(addsuffix .o, $(basename $(FSOURCES)))
MODS = $(addsuffix .mod, $(basename $(FSOURCES)))
#------ That other language -------------------------------------------
CFLAGS = -Wall -pedantic -mtune=native -ffast-math -O3
COBJS = $(CSOURCES:%.c=%.o)
#------ That other OO language ----------------------------------------
CPPFLAGS = -Wall -pedantic -mtune=native -O3
%.o: %.cpp
	$(CXX) $(CPPFLAGS) -c  -o $@ $<

CPPOBJS = $(CPPSOURCES:%.cpp=%.o)
#------ A Fortran Program--------------------------------
$(EXEC): $(FOBJS) 
	$(FC) -o $@ $(FFLAGS) $(FOBJS) $(LIBS) $(LDFLAGS)
#----------- CLEAN ----------------------------
clean:
	$(RM) $(FOBJS) $(COBJS) $(MODS)

